<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- 
      CST3144 FULL-STACK COURSEWORK â€” FRONTEND (Vue.js SPA)

      This single-page application (SPA) implements:
      - Dynamic lesson list (with subjects, locations, price, spaces, icons/images)
      - Search and sorting (by subject, location, price, and spaces)
      - Add-to-cart logic with spaces decrement
      - Cart view with quantity updates and line totals
      - Checkout form with client-side validation (Name + Phone)
      
      All interactivity is controlled via lessons.js (Vue 2).
  -->

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CST3144 Lessons App</title>

  <!-- Custom styling -->
  <link rel="stylesheet" href="style.css" />

  <!-- Font Awesome icon library for UI icons (cart, location, etc.) -->
  <link 
    rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" 
  />

  <!-- Vue 2 (CDN) â€” required by coursework spec -->
  <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
</head>

<body>
  <!-- 
      All Vue behaviour is mounted on this root element (#app).
      Vue controls:
      - lesson data and filtering
      - sorting
      - cart contents
      - form validation and checkout state
  -->
  <div id="app">

    <!-- =======================================================
         HEADER: Logo, search, sorting, and cart button
         ======================================================= -->
    <header class="header">

      <!-- Logo / home button -->
      <h1 class="logo" @click="goHome" style="cursor: pointer;">
        <i class="fa-solid fa-graduation-cap"></i> LessonHub
      </h1>

      <div class="controls">
        <!-- Search bar (front-end search: Approach 1) -->
        <input
          v-model="searchTerm"
          class="search"
          placeholder="Search by subject, location, price, or spaces..."
        />

        <!-- Sorting controls -->
        <div class="sort-group">
          <!-- Sort by attribute -->
          <div class="custom-select">
            <select v-model="sortBy">
              <option value="subject">Subject</option>
              <option value="location">Location</option>
              <option value="price">Price</option>
              <option value="spaces">Spaces</option>
            </select>
            <i class="fa-solid fa-angle-down"></i>
          </div>

          <!-- Sort order -->
          <div class="custom-select">
            <select v-model="sortOrder">
              <option value="asc">Ascending</option>
              <option value="desc">Descending</option>
            </select>
            <i class="fa-solid fa-angle-down"></i>
          </div>
        </div>

        <!-- Cart toggle button -->
        <button
          class="cart-btn"
          @click="showCart = !showCart"
          :disabled="cartItemCount === 0"
        >
          <i class="fa-solid fa-cart-shopping"></i>
          <span>Cart</span>

          <span v-if="cartItemCount" class="cart-badge">
            {{ cartItemCount }}
          </span>
        </button>
      </div>
    </header>

    <!-- =======================================================
         MAIN CONTENT: Lessons view OR Cart view
         ======================================================= -->
    <main>
      <transition name="fade" mode="out-in">

        <!-- ==================== LESSON LIST VIEW ==================== -->
        <section v-if="!showCart" key="lessons" class="lesson-section">
          <h2>Available Lessons</h2>
          <p class="page-subtitle">
            Browse and book lessons across Hendon, Colindale, Brent Cross and more.
          </p>

          <p class="lesson-count">
            {{ sortedAndFilteredLessons.length }} lesson(s) found
          </p>

          <p
            v-if="!sortedAndFilteredLessons.length && searchTerm"
            class="no-results"
          >
            <i class="fa-solid fa-magnifying-glass"></i>
            No lessons found for "{{ searchTerm }}".
          </p>

          <div v-else class="lesson-grid">
            <!-- v-for list of lessons (required by spec) -->
            <div
              class="lesson-card"
              v-for="lesson in sortedAndFilteredLessons"
              :key="lesson.id"
            >
              <!-- Lesson image -->
              <img
                :src="lesson.image"
                :alt="lesson.subject + ' lesson icon'"
                class="lesson-img"
              />

              <!-- Lesson details -->
              <div class="lesson-info">
                <h3>
                  <i :class="lesson.icon"></i>
                  {{ lesson.subject }}
                </h3>

                <p>
                  <i class="fa-solid fa-location-dot"></i>
                  {{ lesson.location }}
                </p>

                <p>Â£{{ lesson.price }}</p>

                <p>
                  <i class="fa-solid fa-users"></i>
                  Spaces: {{ lesson.spaces }}
                  <span
                    v-if="lesson.spaces > 0 && lesson.spaces <= 2"
                    class="badge-low"
                  >
                    Almost full
                  </span>
                </p>
              </div>

              <!-- Add-to-cart button (disabled when spaces = 0) -->
              <button
                @click="addToCart(lesson)"
                :disabled="lesson.spaces === 0"
                class="add-btn"
              >
                <i class="fa-solid fa-cart-plus"></i>
                {{ lesson.spaces > 0 ? 'Add to Cart' : 'Full' }}
              </button>
            </div>
          </div>
        </section>

        <!-- ==================== CART & CHECKOUT VIEW ==================== -->
        <section v-else key="cart" class="cart-section">
          <div class="cart-header">
            <button class="back-btn" @click="showCart = false">
              <i class="fa-solid fa-arrow-left"></i> Back to lessons
            </button>
            <h2>Your Cart</h2>
          </div>

          <p v-if="!cart.length" class="cart-empty">
            Your cart is empty. Add some lessons to continue ðŸŒ±
          </p>

          <div v-else>
            <!-- Cart list -->
            <ul class="cart-list">
              <li class="cart-header-row">
                <span>Lesson</span>
                <span>Price</span>
                <span>Quantity</span>
                <span>Line Total</span>
                <span></span>
              </li>

              <li
                v-for="(item, index) in cart"
                :key="item.id"
                class="cart-item"
              >
                <div class="cart-item-info">
                  <img
                    :src="item.image"
                    :alt="item.subject + ' lesson icon'"
                    class="cart-thumb"
                  />
                  <div>
                    <h4>{{ item.subject }}</h4>
                    <p>
                      <i class="fa-solid fa-location-dot"></i>
                      {{ item.location }}
                    </p>
                  </div>
                </div>

                <span class="cart-price">
                  Â£{{ item.price }}
                </span>

                <div class="cart-qty">
                  <button
                    class="qty-btn"
                    type="button"
                    @click="decreaseQuantity(index)"
                  >
                    -
                  </button>
                  <span class="qty-value">
                    {{ item.quantity }}
                  </span>
                  <button
                    class="qty-btn"
                    type="button"
                    @click="increaseQuantity(index)"
                  >
                    +
                  </button>
                </div>

                <span class="cart-line-total">
                  Â£{{ (item.price * item.quantity).toFixed(2) }}
                </span>

                <button
                  class="remove-btn"
                  type="button"
                  @click="removeFromCart(index)"
                >
                  <i class="fa-solid fa-trash"></i>
                </button>
              </li>
            </ul>

            <div class="cart-total-box">
              <h3>
                {{ cartItemCount }} item(s) |
                Total: Â£{{ cartTotal.toFixed(2) }}
              </h3>
            </div>

            <!-- Checkout form -->
            <div class="checkout-box">
              <h3>Checkout</h3>

              <form @submit.prevent="checkout">
                <!-- Name field -->
                <label>
                  Name
                  <input
                    v-model="name"
                    type="text"
                    placeholder="Full name (letters only)"
                    @input="nameError = ''; orderConfirmed = false"
                  />
                </label>
                <p v-if="nameError" class="error">
                  {{ nameError }}
                </p>
              
                <!-- Phone field -->
                <label>
                  Phone
                  <input
                    v-model="phone"
                    type="tel"
                    placeholder="Mobile number (numbers only)"
                    @input="phoneError = ''; orderConfirmed = false"
                  />
                </label>
                <p v-if="phoneError" class="error">
                  {{ phoneError }}
                </p>
              
                <!-- Email field -->
                <label>
                  Email
                  <input
                    v-model="email"
                    type="email"
                    placeholder="Email address"
                    @input="emailError = ''; orderConfirmed = false"
                  />
                </label>
                <p v-if="emailError" class="error">
                  {{ emailError }}
                </p>
              
                <!-- Submit order button -->
                <button
                  class="checkout-btn"
                  type="submit"
                  :disabled="!cart.length || !isFormValid"
                >
                  <i class="fa-solid fa-paper-plane"></i>
                  Submit Order
                </button>
              </form>
              
              <!-- Success message after order -->
              <p v-if="orderConfirmed" class="success">
                {{ orderMessage }}
              </p>
            </div>
          </div>
        </section>
      </transition>
    </main>
  </div>

  <!-- Vue logic (Vue 2, matching this template) -->
  <script src="lessons.js"></script>
</body>
</html>